# ูุณุชูุฏุงุช ูู ูพุฑูฺู: ุฑุจุงุช ุตุฏูุฑ ูพุดโูุงฺฉุชูุฑ ุขุณุงูุณูุฑ

ฺฉุงุฑูุฑูุง: ุดุฑฺฉุช ุขุณุงูุณูุฑ ุฑูุงู ุฑู ุฏูุงููุฏ  
ุชุงุฑุฎ ุชุฏูู: ุขุฐุฑ ฑดฐด  
ูุณุฎู ุณูุฏ: 1.1 (ุจุงุฒุทุฑุงุญ ุดุฏู)

---

## ฑ. ุดุฑุญ ูุณุฆูู (Problem Statement)

ฺฉุงุฑูุฑูุง ูุงุฒููุฏ ฺฉ ุฑุจุงุช ุชูฺฏุฑุงู ุงุณุช ฺฉู ูุฑุขูุฏ ุตุฏูุฑ ูพุดโูุงฺฉุชูุฑ ุจุฑุง ูพุฑูฺูโูุง ูุตุจ ุขุณุงูุณูุฑ ุฑุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงูุฌุงู ุฏูุฏ. ุฏุฑ ุญุงู ุญุงุถุฑ ุตุฏูุฑ ูพุดโูุงฺฉุชูุฑ ุจู ุตูุฑุช ุฏุณุช ุงูุฌุงู ูโุดูุฏ ฺฉู:

- ุฒูุงูโุจุฑ ุงุณุช.
- ูุณุชุนุฏ ุฎุทุง ูุญุงุณุจุงุช ุงุณุช.
- ุงุณุชุงูุฏุงุฑุฏ ู ฺฉูพุงุฑฺู ูุณุช.

ูพุดโูุงฺฉุชูุฑูุง ุจุฑ ุงุณุงุณ ููุงุฑุฏ ุฒุฑ ุชุบุฑ ูโฺฉููุฏ:

- **ุชุนุฏุงุฏ ุชููู (ุทุจูุงุช)**
- **ููุน ุณุณุชู ุขุณุงูุณูุฑ** (ูุฏุฑููฺฉ / ฺฉุดุด ฺฏุฑูุณ)
- **ููุน ุงููุงู** (ุซุงุจุชุ ุฎุทุ ุจุง ูุงู ุฏุงูุงูฺฉ)

ููฺูู ูุฏุฑ ุณุณุชู ุจุงุฏ ุจุชูุงูุฏ ููุช ุงููุงู ู ุจุนุถ ุชูุธูุงุช ุฑุง ุงุฒ ุทุฑู ุฑุจุงุช ุจุฑูุฒุฑุณุงู ฺฉูุฏุ ุจุฏูู ูุงุฒ ุจู ุชุบุฑ ุฏุฑ ฺฉุฏ.

---

## ฒ. ุชุญูู ูุงุฒููุฏโูุง (System Analysis)

### ฒ.ฑ. ูุฑูุฏโูุง ุณุณุชู

ุฑุจุงุช ุจุงุฏ ุงุทูุงุนุงุช ุฒุฑ ุฑุง ุงุฒ ฺฉุงุฑุจุฑ (ฺฉุงุฑุดูุงุณ ูุฑูุด/ฺฉุงุฑูุฑูุง) ุฏุฑุงูุช ฺฉูุฏ:

1. **ูุดุฎุตุงุช ูุดุชุฑ ู ูพุฑูฺู**
   - ูุงู ูุดุชุฑ (Customer Name)
   - ูุงู ูพุฑูฺู/ูููุนุช (Project Name)

2. **ููุน ุณุณุชู ุขุณุงูุณูุฑ**
   - ุงูุชุฎุงุจ ุจู ฺฏุฒููโูุง ุฒุฑ (ุจุง ุฏฺฉูู ุดุดูโุง):
     - ยซูุฏุฑููฺฉยป (hydraulic)
     - ยซฺฉุดุด ฺฏุฑูุณยป (gearless)

3. **ุชุนุฏุงุฏ ุชููู (ุทุจูุงุช)**
   - ฺฉ ุนุฏุฏ ุตุญุญ ูุซุจุช: \( N \ge 1 \)

### ฒ.ฒ. ุฎุฑูุฌ ุณุณุชู

ุฎุฑูุฌ ุงุตู ุณุณุชู:

- ฺฉ **ูุงู PDF** ุจุง ุทุฑุงุญ ุฑุณู ู ุดฺฉู ฺฉู:
  - ุณุฑุจุฑฺฏ ู ูุฑูุช ุขู ูุทุงุจู ูููููโูุง ุงุฑุงุฆูโุดุฏู ุชูุณุท ฺฉุงุฑูุฑูุง ุจุงุดุฏ.
  - ุดุงูู ุงุทูุงุนุงุช ุนููู ูุงฺฉุชูุฑ (ูุดุฎุตุงุช ูุดุชุฑุ ูพุฑูฺูุ ุชุงุฑุฎุ ููุน ุณุณุชูุ ุชุนุฏุงุฏ ุชููู) ุจุงุดุฏ.
  - ุดุงูู ุฌุฏูู ุงููุงู ุจู ุดฺฉู ุฒุฑ ุจุงุดุฏ:
    - ูุงู ฺฉุงูุง/ุฎุฏูุช
    - ูุงุญุฏ
    - ุชุนุฏุงุฏ / ูุชุฑุงฺ ูุญุงุณุจูโุดุฏู
    - ููุช ูุงุญุฏ
    - ููุช ฺฉู ุฑุฏู
  - ูุฌููุน ฺฉู ูุงฺฉุชูุฑ ุฏุฑ ุงูุชูุง ุฌุฏูู ููุงุด ุฏุงุฏู ุดูุฏ.

ุฎุฑูุฌโูุง ุชฺฉูู (ุฏุฑ ุณุทุญ ุฏุชุงุจุณุ ุจุฏูู ุงูุฒุงู ุจู ููุงุด ุจุฑุง ฺฉุงุฑุจุฑ):

- ุซุจุช **ุฑฺฉูุฑุฏ ูุงฺฉุชูุฑ** ุฏุฑ ุฏุชุงุจุณ (ุงุทูุงุนุงุช ฺฉู).
- ุซุจุช **ุขุชูโูุง ูุงฺฉุชูุฑ** ุจู ููุฑุงู snapshot ููุช ู ูุงู ุฏุฑ ุฒูุงู ุตุฏูุฑ.

### ฒ.ณ. ุฏุณุชูโุจูุฏ ุงููุงู (Logic Breakdown)

ุจุฑุง ูุญุงุณุจู ููุงุฏุฑุ ุงููุงู ุจู ุณู ุฏุณุชู ุงุตู ุชูุณู ูโุดููุฏ:

1. **ุงููุงู ุซุงุจุช (Fixed)**
   - ุชุนุฏุงุฏ ุขูโูุง ูุณุชูู ุงุฒ ุชุนุฏุงุฏ ุทุจูุงุช ุจูุฏู ู ููุดู ุซุงุจุช ุงุณุช.
   - ูุซุงู: ููุชูุฑุ ุชุงุจูู ูุฑูุงูุ ุจุฑุฎ ูุทุนุงุช ฺฉุงุจู.
   - ุฏุฑ ุฏุชุงุจุณ: `type = 'fixed'`

2. **ุงููุงู ุฎุท (Linear)**
   - ุชุนุฏุงุฏ ุง ูุชุฑุงฺ ุขูโูุง ุชุงุจุน ุงุฒ ุชุนุฏุงุฏ ุชููู \( N \) ุงุณุช.
   - ูุฑู ฺฉู ูุญุงุณุจู:

     \[ quantity = factor \times N + base\_add \]

   - ูุซุงู: ุณู ฺฉุงุจูุ ุชุฑุงูู ฺฉุงุจูุ ุฏุงฺฉุชุ ุณู ุชูููุ ููู ุฏุฑุจุ ุฏฺฉุชุงุชูุฑุ ุงุฌุฑุช ูุตุจุ ุณูุณูุฑ/ุขููุฑุจุง.
   - ุฏุฑ ุฏุชุงุจุณ: `type = 'linear'`

3. **ุงููุงู ุจุง ูุงู ุฏุงูุงูฺฉ (Dynamic Naming)**
   - ุชุนุฏุงุฏ ุงู ุงููุงู ููฺฉู ุงุณุช ุซุงุจุช ุจุงุดุฏุ ุงูุง ูุงู ุขูโูุง ุจุณุชู ุจู \( N \) ุชุบุฑ ูโฺฉูุฏ.
   - ูุซุงู: ุดุงุณ ุฏุงุฎู ฺฉุงุจู ฺฉู ุจุงุฏ ุจู ุตูุฑุช ยซุดุงุณ ุฏุงุฎู ฺฉุงุจู X ุชูููยป ููุงุด ุฏุงุฏู ุดูุฏ ฺฉู \( X = N + 1 \).
   - ุฏุฑ ุฏุชุงุจุณ: `type = 'dynamic_name'` ู ุงุณุชูุงุฏู ุงุฒ `name_pattern` ุฌูุช ุณุงุฎุช ูุงู ููุง.

4. **ุงููุงู ุงุฎุชุตุงุต ุณุณุชู (System-specific)**
   - ุจุฑุฎ ุงููุงู ููุท ุฏุฑ ุณุณุชู ูุฏุฑููฺฉ ุง ููุท ุฏุฑ ฺฏุฑูุณ ุงุณุชูุงุฏู ูโุดููุฏ.
   - ูุซุงู ุณุณุชู ูุฏุฑููฺฉ:
     - ูพุงูุฑ ููุชุ ุฌฺฉุ ุฑูุบูุ ุดููฺฏ.
   - ูุซุงู ุณุณุชู ฺฏุฑูุณ:
     - ููุชูุฑ ฺฏุฑูุณุ ฺฉุงุฏุฑ ูุฒููุ ฺฏุงูุฑูุฑุ ุณู ุจฺฉุณูโูุง ููุฑู ถ ู ฑฐ.
   - ุฏุฑ ุฏุชุงุจุณ ุจุง ููุฏ `system` ฺฉูุชุฑู ูโุดููุฏ.

---

## ณ. ููุงูู ุชุฌุงุฑ ู ูุฑูููโูุง (Business Logic)

### ณ.ฑ. ุชูฺฉฺฉ ุงููุงู ุจุฑ ุงุณุงุณ ุณุณุชู

- ุงฺฏุฑ ุณุณุชู **ูุฏุฑููฺฉ** ุงูุชุฎุงุจ ุดูุฏ:
  - ุงููุงู ูุฑุจูุท ุจู ุณุณุชู ูุฏุฑููฺฉ (ูพุงูุฑ ููุชุ ุฌฺฉุ ุฑูุบูุ ุดููฺฏ ู ...) ูุนุงู ุดููุฏ.
  - ุงููุงู ูุฎุตูุต ฺฏุฑูุณ (ููุชูุฑ ฺฏุฑูุณุ ฺฏุงูุฑูุฑุ ุณุณุชู ูุฒูู ุชุนุงุฏู ุฎุงุตุ ุณู ุจฺฉุณูโูุง ูุฑุจูุทู ู ...) ุญุฐู/ูุงุฏุฏู ฺฏุฑูุชู ุดููุฏ.

- ุงฺฏุฑ ุณุณุชู **ฺฏุฑูุณ** ุงูุชุฎุงุจ ุดูุฏ:
  - ุงููุงู ูุฑุจูุท ุจู ุณุณุชู ฺฏุฑูุณ (ููุชูุฑ ฺฏุฑูุณุ ฺฉุงุฏุฑ ูุฒููุ ฺฏุงูุฑูุฑุ ุณู ุจฺฉุณูโูุง ููุฑู ฑฐ ู ถ ู ...) ูุนุงู ุดููุฏ.
  - ุงููุงู ูุฏุฑููฺฉ (ูพุงูุฑ ููุชุ ุฌฺฉ ู ...) ูุงุฏุฏู ฺฏุฑูุชู ุดููุฏ.

ุงู ููุชุฑูฺฏ ุงุฒ ุทุฑู ููุฏ `system` ุฏุฑ ุฌุฏูู `products` ุงูุฌุงู ูโุดูุฏ:

- `system = 'common'` โ ุจุฑุง ูุฑ ุฏู ุณุณุชู ุงุณุชูุงุฏู ูโุดูุฏ.
- `system = 'hydraulic'` โ ููุท ุฏุฑ ุณุณุชู ูุฏุฑููฺฉ.
- `system = 'gearless'` โ ููุท ุฏุฑ ุณุณุชู ฺฏุฑูุณ.

### ณ.ฒ. ูุฑูููโูุง ูุญุงุณุจุงุช ููููู (ุทุจู ุฏุณุชูุฑ ฺฉุงุฑูุฑูุง)

ุฏุฑ ูุฑูููโูุง ุฒุฑุ \( N \) ุจุฑุงุจุฑ ุงุณุช ุจุง ุชุนุฏุงุฏ ุชููู.

> **ูฺฉุชู:** ุงู ููุงุฏุฑ ุจู ุตูุฑุช `factor` ู `base_add` ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดููุฏ. ูุงุฌฺฉ ูุญุงุณุจุงุช ุจุงุฏ ุนููู ุจุงุดุฏ ู ุงุฒ ุฑู ุงู ููุฏูุงุ ููุฏุงุฑ ููุง ุฑุง ูุญุงุณุจู ฺฉูุฏ.

| ุฑุฏู | ูุงู ฺฉุงูุง / ุฎุฏูุช                    | ููุน ูุญุงุณุจู                                      | ููุน ุฏุชุงุจุณ          |
|------|--------------------------------------|--------------------------------------------------|----------------------|
| 1    | ุณู ฺฉุงุจู (ููุฑู ด ุง ฐ.ทต)          | \( quantity = N \times 20 \) ูุชุฑ              | `type = 'linear'`    |
| 2    | ุชุฑุงูู ฺฉุงุจู                          | \( quantity = N \times 4 + 5 \) ูุชุฑ (ต ูุชุฑ ุฑุฒุฑู) | `type = 'linear'` with `base_add = 5` |
| 3    | ุณู ุจฺฉุณู ฺฏุงูุฑูุฑ (ฺฏุฑูุณ)            | \( quantity = N \times 10 \) ูุชุฑ (ููุท ฺฏุฑูุณ) | `type = 'linear'`, `system = 'gearless'` |
| 4    | ุฏุงฺฉุช (ููุฑู ณ ุง ด)                  | \( quantity = N \times 4 \) ูุชุฑ              | `type = 'linear'`    |
| 5    | ุณู ุชููู                             | \( quantity = N \times 5 \) ูุชุฑ              | `type = 'linear'`    |
| 6    | ููู ุฏุฑุจ                              | \( quantity = N \) ุนุฏุฏ                        | `type = 'linear'`    |
| 7    | ุฏฺฉุชุงุชูุฑ (ุขุฑุงูโุจูุฏ)                 | \( quantity = N \) ุนุฏุฏ                        | `type = 'linear'`    |
| 8    | ุดุงุณ (ฺฉูุฏ) ุทุจูุงุช                   | \( quantity = N \) ุนุฏุฏ                        | `type = 'linear'`    |
| 9    | ุงุฌุฑุช ูุตุจ                             | \( quantity = N \) ูุงุญุฏ                       | `type = 'linear'`    |
| 10   | ุดุงุณ ุฏุงุฎู ฺฉุงุจู                     | ุชุนุฏุงุฏ ุซุงุจุช ฑุ ูุงู ูุงุจุณุชู ุจู \(N+1\) ุชููู     | `type = 'dynamic_name'` |
| 11   | ุขููุฑุจุง/ุณูุณูุฑ (ุดุงุจููู)               | \( quantity = N + 2 \) ุนุฏุฏ                    | `type = 'linear'` ุจุง `factor = 1` ู `base_add = 2` |

### ณ.ณ. ููุทู Dynamic Name

ุจุฑุง ุงููุงู ฺฉู ููุน ุขูโูุง `dynamic_name` ุงุณุช:

- ุชุนุฏุงุฏ ุขูโูุง ูโุชูุงูุฏ:
  - ุซุงุจุช ุจุงุดุฏ (ูุซูุงู ููุดู ฑ ุนุฏุฏ)ุ ุง
  - ุจุฑ ุงุณุงุณ ููุงู ููุทู `factor * N + base_add` ูุญุงุณุจู ุดูุฏ (ุฏุฑ ุตูุฑุช ูุงุฒ).

- ูุงู ููุง ุจู ฺฉูฺฉ `name_pattern` ุณุงุฎุชู ูโุดูุฏ. ูุซุงู ุจุฑุง ุดุงุณ ุฏุงุฎู ฺฉุงุจู:

  - ููุฏุงุฑ ุซุงุจุช ุฏุฑ ุฏุชุงุจุณ:
    - `name = 'ุดุงุณ ุฏุงุฎู ฺฉุงุจู'`
    - `name_pattern = 'ุดุงุณ ุฏุงุฎู ฺฉุงุจู ${stops} ุชููู'`
    - ููุฏ ฺฉูฺฉ: `stops_offset = 1` (ุจู ุงู ูุนู ฺฉู \( stops = N + 1 \))

- ููุชูุฑ ูุญุงุณุจุงุช ุจุงุฏ ุจุง ุชูุฌู ุจู `name_pattern` ู `stops_offset` ูุงู ููุง ฺฉุงูุง ุฑุง ุจุณุงุฒุฏ ู ุฏุฑ ุฌุฏูู ุงููุงู ูุงฺฉุชูุฑ ุฐุฎุฑู ฺฉูุฏ.

> **ุชุงฺฉุฏ ููู:** ูฺโฺฉุฏุงู ุงุฒ ุงุนุฏุงุฏ ู ูุฑูููโูุง ูุจุงุฏ ุฏุฑ ฺฉุฏ hard-code ุดููุฏ. ูุฑฺฏููู ุชุบุฑ ุฏุฑ ูุฑูููโูุง ู ุถุฑุงุจ ุจุงุฏ ููุท ุงุฒ ุทุฑู ุฏุชุงุจุณ ุงูุฌุงู ุดูุฏ.

---

## ด. ูุนูุงุฑ ูพุดููุงุฏ ู ุฏุชุงุจุณ (Architecture)

### ด.ฑ. ุชฺฉููููฺโูุง

- ุฒุจุงู ุจุฑูุงููโููุณ: **Python 3.10+**
- ูุฑูโูุฑฺฉ ุฑุจุงุช ุชูฺฏุฑุงู: **python-telegram-bot** (ูุณุฎู ฒฐ+ ูุจุชู ุจุฑ async).
- ุฏุชุงุจุณ: **SQLite** (ููฺฉุงู ู ุณุจฺฉุ ูุงุจู ุจฺฉุงูพโฺฏุฑ ุณุงุฏู).
- ููุชูุฑ ูุงูุจ ู PDF:
  - **Jinja2** ุจุฑุง ุณุงุฎุช HTML.
  - **pdfkit** (ูุจุชู ุจุฑ wkhtmltopdf) ุจุฑุง ุชุจุฏู HTML ุจู PDF.

### ด.ฒ. ุณุงุฎุชุงุฑ ูุงูโูุง (Application Layers)

ุจุฑุง ุชูุฒ ฺฉุฏ ู ูุงุจูุช ุชูุณุนู ุฏุฑ ุขูุฏูุ ูพุดููุงุฏ ูโุดูุฏ ุณุงุฎุชุงุฑ ูพุฑูฺู ุญุฏุงูู ุดุงูู ูุงูโูุง ุฒุฑ ุจุงุดุฏ:

- `db/` โ ูุงฺูู ุฏุณุชุฑุณ ุจู ุฏุชุงุจุณ (CRUD ุจุฑุง products, invoices, invoice_items, settings).
- `logic/` โ ูุงฺูู ููุชูุฑ ูุญุงุณุจุงุช (ุฎูุงูุฏู ูุญุตููุงุชุ ูุญุงุณุจู ููุงุฏุฑุ ุณุงุฎุช ูุณุช ุงููุงู ูุงฺฉุชูุฑ).
- `pdf/` โ ูุงฺูู ุชููุฏ PDF (ุฑูุฏุฑ Jinja2 ู pdfkit).
- `bot/` โ ูุงฺูู ุฑุจุงุช ุชูฺฏุฑุงู (ConversationHandlerุ ุฏุณุชูุฑุงุช ฺฉุงุฑุจุฑ ู ุงุฏูู).

ุงู ุฌุฏุงุณุงุฒ ุจุงุนุซ ูโุดูุฏ:

- ุชุณุชโููุณ ุฑุงุญุชโุชุฑ ุจุงุดุฏ.
- ุฏุฑ ุขูุฏู ุจุชูุงู ูพูู ูุจ ุงุฏูู ุง API ูุณุชูู ุฑู ููู ูุงุฌฺฉ ูพุงุฏูโุณุงุฒ ฺฉุฑุฏ.

### ด.ณ. ุงุณฺฉูุง ุฏุชุงุจุณ (Schema)

#### ด.ณ.ฑ. ุฌุฏูู ูุญุตููุงุช (`products`)

```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    code TEXT,                 -- ฺฉุฏ ฺฉุงูุง (ุงุฎุชุงุฑุ ุจุฑุง ุงุณุชุงูุฏุงุฑุฏุณุงุฒ ุฏุงุฎู)
    name TEXT,                 -- ูุงู ูพุงู ฺฉุงูุง
    unit TEXT,                 -- ูุงุญุฏ (ูุชุฑุ ุนุฏุฏุ ุฏุณุชฺฏุงูุ ูุงุญุฏ)
    price INTEGER,             -- ููุช ูุงุญุฏ (ุฑุงู)
    system TEXT,               -- 'common', 'hydraulic', 'gearless'
    type TEXT,                 -- 'fixed', 'linear', 'dynamic_name'
    factor REAL,               -- ุถุฑุจ ูุฑููู (ูุซูุงู 20 ุจุฑุง ุณู ฺฉุงุจู)
    base_add REAL,             -- ููุฏุงุฑ ุซุงุจุช ุงุถุงูู (ูุซูุงู 5 ูุชุฑ ุฑุฒุฑู)
    name_pattern TEXT,         -- ุงูฺฏู ูุงู ุฏุงูุงูฺฉุ ูุซู: 'ุดุงุณ ุฏุงุฎู ฺฉุงุจู ${stops} ุชููู'
    stops_offset INTEGER,      -- ููุฏุงุฑ ุงุถุงูู ุจุฑุง ุชูููโูุง (ูุซูุงู 1 ุจุฑุง N+1)
    category TEXT,             -- ุฏุณุชูโุจูุฏ ฺฉุงูุง (ูุซูุงู 'wire', 'cabin', 'labor')
    is_active INTEGER DEFAULT 1, -- 1: ูุนุงูุ 0: ุบุฑูุนุงู
    min_floors INTEGER,        -- ุญุฏุงูู ุชูููโูุง ุจุฑุง ูุนุงู ุดุฏู (ุงุฎุชุงุฑ)
    max_floors INTEGER         -- ุญุฏุงฺฉุซุฑ ุชูููโูุง ุจุฑุง ูุนุงู ุดุฏู (ุงุฎุชุงุฑ)
);
```

#### ด.ณ.ฒ. ุฌุฏูู ูุงฺฉุชูุฑูุง (`invoices`)

ุจุฑุง ูฺฏูุฏุงุฑ ุงุทูุงุนุงุช ฺฉู ูุฑ ูพุดโูุงฺฉุชูุฑ:

```sql
CREATE TABLE invoices (
    id INTEGER PRIMARY KEY,
    customer_name TEXT,        -- ูุงู ูุดุชุฑ
    project_name TEXT,         -- ูุงู/ูููุนุช ูพุฑูฺู
    system TEXT,               -- 'hydraulic' ุง 'gearless'
    floors INTEGER,            -- ุชุนุฏุงุฏ ุชููู (N)
    total_price INTEGER,       -- ูุฌููุน ฺฉู ูุงฺฉุชูุฑ
    created_at TEXT            -- ุชุงุฑุฎ/ุฒูุงู ุตุฏูุฑ ุจู ูุฑูุช ISO (ูุซูุงู '2025-12-01T10:30:00')
);
```

#### ด.ณ.ณ. ุฌุฏูู ุขุชูโูุง ูุงฺฉุชูุฑ (`invoice_items`)

ุจุฑุง ูฺฏูุฏุงุฑ ุฌุฒุงุช ุฑุฏูโูุง ูุฑ ูุงฺฉุชูุฑุ ููุฑุงู ุจุง snapshot ููุช ู ูุงู ุฏุฑ ุฒูุงู ุตุฏูุฑ:

```sql
CREATE TABLE invoice_items (
    id INTEGER PRIMARY KEY,
    invoice_id INTEGER,        -- ุฑูุฑูุณ ุจู ูุงฺฉุชูุฑ ูุฑุจูุทู
    product_id INTEGER,        -- ุฑูุฑูุณ ุจู products ุฌูุช ุชุญูู ุฏุงุฎู
    name TEXT,                 -- ูุงู ููุง ฺฉุงูุง ุฏุฑ ูุงฺฉุชูุฑ (ุดุงูู ุฏุงูุงูฺฉโูุง)
    unit TEXT,                 -- ูุงุญุฏ
    quantity REAL,             -- ุชุนุฏุงุฏ/ูุชุฑุงฺ ูุญุงุณุจูโุดุฏู
    unit_price INTEGER,        -- ููุช ูุงุญุฏ ุฏุฑ ูุญุธู ุตุฏูุฑ ูุงฺฉุชูุฑ
    total_price INTEGER,       -- ุญุงุตูโุถุฑุจ quantity * unit_price
    FOREIGN KEY (invoice_id) REFERENCES invoices(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

> **ูฺฉุชู ููู:** ุฐุฎุฑู ูุงู ู ููุช ุฏุฑ `invoice_items` ุจุงุนุซ ูโุดูุฏ ุญุช ูพุณ ุงุฒ ุชุบุฑ ููุช ุง ูุงู ฺฉุงูุง ุฏุฑ `products`ุ ูุงฺฉุชูุฑูุง ูุฏู ููฺูุงู ูุนุชุจุฑ ู ูุงุจู ุงุณุชูุงุฏ ุจุงู ุจูุงููุฏ.

#### ด.ณ.ด. ุฌุฏูู ุชูุธูุงุช (`settings`)

ุจุฑุง ูฺฏูุฏุงุฑ ุชูุธูุงุช ฺฉู ุณุณุชู (ุฏุฑ ูุณุฎู ูุนู ูโุชูุงูุฏ ุญุฏุงูู ุจุงุดุฏ):

```sql
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT
);
```

ููููู ููุงุฏุฑ ููฺฉู:

- `COMPANY_NAME`
- `COMPANY_ADDRESS`
- `COMPANY_PHONE`
- `COMPANY_LOGO_PATH`

(ุงุณุชูุงุฏู ุจุฑุง ุณุฑุจุฑฺฏ PDF ู ุงุทูุงุนุงุช ุชูุงุณ.)

---

## ต. ูุณุฑ ุชฺฉูู ูพุฑูฺู (Implementation Roadmap)

### ูุงุฒ ฑ: ุฑุงูโุงูุฏุงุฒ ูุณุชู ู ุฏุชุงุจุณ

1. ุงุฌุงุฏ ุฏุชุงุจุณ SQLite ู ุฌุฏุงูู ุฒุฑ:
   - `products`
   - `invoices`
   - `invoice_items`
   - `settings`

2. ูุงุฑุฏ ฺฉุฑุฏู ุฏุงุฏูโูุง ุงููู (Seed Data):
   - ุชูุงู ุงููุงู ุงุณุชุฎุฑุงุฌโุดุฏู ุงุฒ ูุงฺฉุชูุฑูุง ููููู ฺฉุงุฑูุฑูุง.
   - ุชุนู `system`, `type`, `factor`, `base_add` ุจุฑุง ูุฑ ุขุชู.
   - ุชูุธู ุงุทูุงุนุงุช ุดุฑฺฉุช ุฏุฑ ุฌุฏูู `settings`.

3. ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช ุชูฺฏุฑุงู:
   - ุงุชุตุงู ุจู Bot Token.
   - ูพุงุฏูโุณุงุฒ ุฏุณุชูุฑ `/start` ู ฺฉ ูพุงู ุฎูุดโุขูุฏ ุณุงุฏู.

### ูุงุฒ ฒ: ูพุงุฏูโุณุงุฒ ููุชูุฑ ูุญุงุณุจุงุช (Logic Engine)

1. ูพุงุฏูโุณุงุฒ ุชุงุจุน ุงุตู:

   ```python
   def calculate_invoice(floors: int, system_type: str) -> dict:
       """
       ูุฑูุฏ: ุชุนุฏุงุฏ ุชููู (N) ู ููุน ุณุณุชู ('hydraulic' ุง 'gearless')
       ุฎุฑูุฌ: ุฏฺฉุดูุฑ ุดุงูู ูุณุช ุงููุงู ูุญุงุณุจูโุดุฏู ู ูุฌููุน ฺฉู
       """
   ```

2. ุนููฺฉุฑุฏ ุชุงุจุน:
   - ุฎูุงูุฏู ูุณุช ูุญุตููุงุช ุงุฒ ุฌุฏูู `products` ุจุง ุดุฑุงุท:
     - `system` = 'common' ุง ุจุฑุงุจุฑ ุจุง `system_type`.
     - `is_active = 1`.
     - ุงฺฏุฑ `min_floors` ุง `max_floors` ุชุนุฑู ุดุฏูุ ุจุฑุฑุณ ุณุงุฒฺฏุงุฑ ุจุง \( N \).
   - ุจุฑุง ูุฑ ูุญุตูู:
     - ูุญุงุณุจู `quantity` ุจุฑ ุงุณุงุณ ููุน (`type`):
       - `fixed` โ ุชุนุฏุงุฏ ุซุงุจุชุ ุงุฒ ุฑู `factor` ุง ููุฏุงุฑ ูุฑุงุฑุฏุงุฏ.
       - `linear` โ \( quantity = factor * N + base_add \).
       - `dynamic_name` โ ุชุนุฏุงุฏ ุทุจู ููุทู ฺฉุงูุง (ูุซูุงู ููุดู ฑ) ู ุณุงุฎุช ูุงู ููุง ุจุง `name_pattern` ู `stops_offset`.
     - ูุญุงุณุจู `total_price = quantity * price`.
   - ุฌูุน ุฒุฏู `total_price` ุชูุงู ุขุชูโูุง ุจุฑุง ุชููุฏ `total_price` ูุงฺฉุชูุฑ.

3. ุชุณุช ุญุงุช (ูุซุงู):
   - ูุฑูุฏ: \( N = 7 \)ุ ุณุณุชู: ฺฏุฑูุณ.
   - ุงูุชุธุงุฑ:
     - ุณู ฺฉุงุจู: \( 7 \times 20 = 140 \) ูุชุฑ.
     - ุชุฑุงูู ฺฉุงุจู: \( 7 \times 4 + 5 = 33 \) ูุชุฑ.
     - ...

### ูุงุฒ ณ: ูุงฺูู ุณุงุฎุช PDF

1. ุทุฑุงุญ ูุงูุจ HTML/CSS:
   - ุณุฑุจุฑฺฏ ูุทุงุจู ุจุง ููููู ฺฉุงุฑูุฑูุง (ููฺฏูุ ูุงู ุดุฑฺฉุชุ ุขุฏุฑุณุ ุชูููุ ุดูุงุฑู ูุงฺฉุชูุฑุ ุชุงุฑุฎ).
   - ุฌุฏูู ุงููุงู ุจุง ุชุชุฑูุง ูุดุฎุต ู ุฑุฏูโูุง ฺฉุงูุง.
   - ููุงุด ูุฌููุน ฺฉู ูุงฺฉุชูุฑ ุฏุฑ ุงูุชูุง.

2. ุงุณุชูุงุฏู ุงุฒ Jinja2:
   - ูุงูุจ HTML ุญุงู ูุชุบุฑูุง ู ุญูููโูุง.
   - ุฑูุฏุฑ ฺฉุฑุฏู ูุงูุจ ุจุง ุฏุงุฏูโูุง ุจุฑฺฏุดุช ุงุฒ `calculate_invoice` ู ุงุทูุงุนุงุช ูุงฺฉุชูุฑ.

3. ุชุจุฏู HTML ุจู PDF:
   - ุงุณุชูุงุฏู ุงุฒ `pdfkit` ู ูุตุจ `wkhtmltopdf` ุฑู ุณุฑูุฑ.
   - ูพฺฉุฑุจูุฏ ุจุฑุง ูพุดุชุจุงู ุงุฒ:
     - **ูููุช ูุงุฑุณ** (ูุซูุงู B Nazanin ุง Tahoma) ุจุง ุงุณุชูุงุฏู ุงุฒ `@font-face`.
     - **ุงุนุฏุงุฏ ูุงุฑุณ ุง ุงูฺฏูุณ** ุทุจู ูุงุฒ ฺฉุงุฑูุฑูุง.

4. ูุงูโฺฏุฐุงุฑ ูุงู PDF:
   - ูพุดููุงุฏ ูุฑูุช:

     ```
     invoice_<invoice_id>_<project_name>_<customer_name>.pdf
     ```

   - ุง ุจุฑ ุงุณุงุณ ุชุงุฑุฎ: `invoice_1404-09-01_...pdf`.

### ูุงุฒ ด: ุฑุงุจุท ฺฉุงุฑุจุฑ ุฑุจุงุช (UI/UX)

1. ูพุงุฏูโุณุงุฒ ุฌุฑุงู ูพุฑุณุด ู ูพุงุณุฎ (ConversationHandler):
   - ูุฑุญูู ฑ: ุฏุฑุงูุช ูุงู ูุดุชุฑ.
   - ูุฑุญูู ฒ: ุฏุฑุงูุช ูุงู ูพุฑูฺู.
   - ูุฑุญูู ณ: ุงูุชุฎุงุจ ููุน ุณุณุชู (ูุฏุฑููฺฉ / ฺฏุฑูุณ) ุจุง ุฏฺฉูู ุดุดูโุง.
   - ูุฑุญูู ด: ุฏุฑุงูุช ุชุนุฏุงุฏ ุชููู (ูุฑูุฏ ุนุฏุฏ).

2. ููุงุด ูพุดโููุงุด ูุจู ุงุฒ ุตุฏูุฑ:
   - ููุงุด ุฎูุงุตู ุงุทูุงุนุงุช:
     - ูุงู ูุดุชุฑ
     - ูุงู ูพุฑูฺู
     - ููุน ุณุณุชู
     - ุชุนุฏุงุฏ ุชููู
     - ุฌูุน ุชูุฑุจ (ุจุฑ ูุจูุง ูุญุงุณุจุงุช ูุนู)
   - ุงุฑุงุฆู ุฏฺฉููโูุง:
     - โ ยซุชุงุฏ ู ุตุฏูุฑ PDFยป
     - ๐ ยซูุฑุงุด ุชุนุฏุงุฏ ุชูููยป (ุฏุฑ ุตูุฑุช ูุงุฒ)
     - โ ยซุงูุตุฑุงูยป (ุจุงุฒฺฏุดุช ุจู ุงูู ุง ุชููู ูุฑุขูุฏ)

3. ูพุณ ุงุฒ ุชุงุฏ:
   - ุงุฌุงุฏ ุฑฺฉูุฑุฏ ุฌุฏุฏ ุฏุฑ ุฌุฏูู `invoices`.
   - ุซุจุช ุงููุงู ุฏุฑ `invoice_items` ููุฑุงู snapshot ููุช.
   - ุชููุฏ PDF ู ุงุฑุณุงู ูุงู ุจู ฺฉุงุฑุจุฑ ุฏุฑ ุชูฺฏุฑุงู.

4. ูพุงุฏูโุณุงุฒ ุงูฺฉุงู ูุบู (Cancel):
   - ุฏุฑ ุชูุงู ูุฑุงุญูุ ฺฉุงุฑุจุฑ ุจุชูุงูุฏ ุจุง ุงุฑุณุงู ฺฉ ุฏุณุชูุฑ ูุดุฎุต (ูุซูุงู `/cancel`) ุง ุงูุชุฎุงุจ ุฏฺฉูู ยซุงูุตุฑุงูยปุ ูุฑุขูุฏ ุฑุง ูุชููู ฺฉูุฏ.

5. ูพุงุฏูโุณุงุฒ ูพูู ุงุฏูู ุณุงุฏู:
   - ุฏุณุชูุฑ `/admin` ุจุฑุง ูุฑูุฏ ุงุฏูู.
   - ูุญุฏูุฏุณุงุฒ ุฏุณุชุฑุณ ุจุฑ ุงุณุงุณ `chat_id` ุง PIN.
   - ุงูฺฉุงูุงุช ุงููู:
     - ูุดุงูุฏู ูุณุช ูุญุตููุงุช (ุจู ุตูุฑุช ุตูุญูโุจูุฏ ุณุงุฏู).
     - ูุฑุงุด ููุช ฺฉุงูุง (ุจุง ุงูุชุฎุงุจ ฺฉุงูุง ู ูุฑูุฏ ููุช ุฌุฏุฏ).

### ูุงุฒ ต: ุชุณุช ู ุชุญูู

1. ุชุณุชโูุง ฺฉุงุฑฺฉุฑุฏ:
   - ุชุณุช ุณูุงุฑููุง ูุฎุชูู ุชุนุฏุงุฏ ุชููู ู ููุน ุณุณุชู.
   - ุจุฑุฑุณ ุตุญุช ูุญุงุณุจุงุช ูุชุฑุงฺ ุณูโูุงุ ุชุนุฏุงุฏ ุงููุงู ู ุฌูุน ฺฉู.
   - ุจุฑุฑุณ ุตุญุช ููุงุด ุงุทูุงุนุงุช ุฏุฑ PDF.

2. ุชุณุชโูุง ุฑุงุจุท ฺฉุงุฑุจุฑ:
   - ุจุฑุฑุณ ุฑูุชุงุฑ ุฏฺฉููโูุงุ ูุณุฑูุง ุจุงุฒฺฏุดุช ู ุงูุตุฑุงู.
   - ุจุฑุฑุณ ูพุงูโูุง ุฎุทุง ูุฑูุฏ ูุงูุนุชุจุฑ (ูุซูุงู ุฏุฑ ุชุนุฏุงุฏ ุชููู).

3. ุชุญูู ููุง:
   - ุณูุฑุณ ฺฉุฏ ฺฉุงูู ูพุฑูฺู.
   - ูุงู ุฏุชุงุจุณ SQLite ุดุงูู Seed Data.
   - ุฏุณุชูุฑุงูุนูู ูุตุจ ู ุฑุงูโุงูุฏุงุฒ (README).
   - ูุณุช ูพุดโูุงุฒูุง (Python versionุ ูุตุจ wkhtmltopdfุ ุชูุธูุงุช Bot Token).

---

## ถ. ูฺฉุชู ููู ุจุฑุง ุจุฑูุงููโููุณ

ุณุงุฎุชุงุฑ ูพุงุฏูโุณุงุฒ ุจุงุฏ ุจู ฺฏูููโุง ุจุงุดุฏ ฺฉู ุฏุฑ ุขูุฏูุ ุฏุฑ ุตูุฑุช ุชุบุฑ ูุฑ ฺฉ ุงุฒ ุงู ููุงุฑุฏ:

- ุถุฑุงุจ ุฎุท (ูุซูุงู ุชุบุฑ ุณู ฺฉุงุจู ุงุฒ ฒฐ ูุชุฑ ุจู ฒฒ ูุชุฑ ุฏุฑ ูุฑ ุชููู)ุ
- ููุงุฏุฑ ุฑุฒุฑู (ูุซูุงู ุชุบุฑ ต ูุชุฑ ุฑุฒุฑู ุจู ธ ูุชุฑ)ุ
- ูุนุงู/ุบุฑูุนุงู ุดุฏู ฺฉ ฺฉุงูุงุ
- ุงุฎุชุตุงุต ุดุฏู ฺฉ ฺฉุงูุง ุจุฑุง ฺฉ ููุน ุณุณุชูุ

ูุงุฒ ุจู ุชุบุฑ ุฏุฑ ฺฉุฏ ุจุฑูุงูู ูุจุงุดุฏ ู ุชูุงู ุชุบุฑุงุช ููุท ุงุฒ ุทุฑู ุฏุชุงุจุณ (ุจุฑูุฒุฑุณุงู ุฑฺฉูุฑุฏูุง ุฌุฏูู `products` ู ุชูุธูุงุช) ุงุนูุงู ุดููุฏ.

